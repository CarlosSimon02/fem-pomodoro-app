(()=>{"use strict";function e(e,t){return(t||document).querySelector(e)}function t(e,t){const i=(t||document).querySelectorAll(e);return Array.from(i)}function i(e,t,i,s){e.addEventListener(t,i,!!s)}function s(e){console.error(e),alert(e)}function r(e){return 60*e}function n(e){return e/60}function o(e){const t=e.filter((({el:e})=>Array.isArray(e)?0===e.length:null===e));if(t.length>0){const e=t.map((({name:e})=>e)).join(", ");throw new Error(`The following element(s) were not found on the page: ${e}`)}}class a{#e;#t;#i;constructor(e,t,i){this.#e=e,this.#t=t,this.#i=i,t.bindOpenSettings(this.openSettings.bind(this)),t.bindCloseSettings(this.closeSettings.bind(this)),t.bindApplySettings(this.applySettings.bind(this)),t.bindProcessFontSelection(this.processFontSelection.bind(this)),t.bindProcessThemeSelection(this.processThemeSelection.bind(this))}openSettings(){const e=this.#e.retrieveSettingsValues();this.#t.setSettingsValues(e),this.#t.showSettingsModal()}closeSettings(){const e=this.#e.retrieveSettingsValues();this.#t.setFontAndTheme(e.font,e.theme),this.#t.closeSettingsModal()}applySettings(t){if(function(t){for(const i of t)if(i.hasAttribute("required"))if("radio"===i.type||"checkbox"===i.type){if(!e(`input[name="${i.name}"]:checked`))return i.setCustomValidity("Please select an option."),i.reportValidity(),!1;i.setCustomValidity("")}else if("text"===i.type){if(""===i.value.trim())return i.setCustomValidity("This field is required."),i.reportValidity(),!1;i.setCustomValidity("")}return!0}(t)){const e=this.#t.getSettingsValues();this.#e.saveSettingsValues(e),this.#i.restartTimer(),this.#t.closeSettingsModal()}}processFontSelection(e){this.#t.setFont(e)}processThemeSelection(e){this.#t.setTheme(e)}}class m{#e;#t;constructor(e,t){this.#e=e,this.#t=t,t.bindPlayPauseTimer(this.playPauseTimer.bind(this)),t.bindRestartTimer(this.restartTimer.bind(this)),t.bindSelectedTimerMode(this.setAndRenderTimerMode.bind(this))}#s(){this.#t.setPlayPauseButtonLabel("Pause");let e=Date.now();const t=setInterval((()=>{const t=Date.now(),i=(t-e)/1e3;this.#e.decreaseTimeRemainingBy(i),this.#r(),e=t,0===this.#e.retrieveTimeRemaining()&&(this.#t.setPlayPauseButtonDisable(!0),this.#n(),this.#t.activateTimerFinishedEffect())}),10);this.#e.saveTimerIntervalId(t)}#n(){this.#e.clearTimerInterval(),this.#t.setPlayPauseButtonLabel("Play"),this.#t.deactivateTimerFinishedEffect()}#r(){this.#t.setTimerAndProgressBarValue(this.#e.retrieveTimeRemaining(),this.#e.retrieveTargetTime())}playPauseTimer(){this.#e.isTimerRunning()?this.#n():this.#s()}restartTimer(){this.#t.setPlayPauseButtonDisable(!1),this.#n(),this.#e.restartTimeRemaining(),this.#r()}setAndRenderTimerMode(e){this.#n(),this.#e.saveCurrentTimerMode(e);const t=0===this.#e.retrieveTimeRemaining();this.#t.setPlayPauseButtonDisable(t),this.#r()}}class h{#o;#a;#m;constructor(e,t,i=t){this.#o=e,this.#a=t,this.#m=i}decreaseTimeRemainingBy(e){this.#m=Math.max(this.#m-e,0)}restartTimeRemaining(){this.#m=this.#a}getName(){return this.#o}getTargetTime(){return this.#a}setTargetTime(e){this.#a=e,this.restartTimeRemaining()}getTimeRemaining(){return this.#m}setTimeRemaining(e){this.#m=e}}class l{#h;#l;#u;#d;#c;#g;#T;#p;#v;constructor(){this.#h=e(".js-open-settings"),this.#l=e(".js-close-settings"),this.#u=e(".js-apply-settings"),this.#d=e(".js-settings"),this.#c=e(".js-pomodoro-target-time"),this.#g=e(".js-short-break-target-time"),this.#T=e(".js-long-break-target-time"),this.#p=t(".js-font-type"),this.#v=t(".js-theme-type"),this.#b()}#b(){try{o([{name:"openSettings",el:this.#h},{name:"closeSettings",el:this.#l},{name:"applySettings",el:this.#u},{name:"settings",el:this.#d},{name:"pomodoroTargetTime",el:this.#c},{name:"shortBreakTargetTime",el:this.#g},{name:"longBreakTargetTime",el:this.#T},{name:"fontTypes",el:this.#p},{name:"themeTypes",el:this.#v}])}catch(e){s(e)}}setSettingsValues(e){this.#c.value=n(e.pomodoroTargetTime),this.#g.value=n(e.shortBreakTargetTime),this.#T.value=n(e.longBreakTargetTime),this.setFontAndTheme(e.font,e.theme)}setFontAndTheme(t,i){let s=e(`.js-font-type[value="${t}"]`),r=e(`.js-theme-type[value="${i}"]`);s.checked=!0,r.checked=!0,s.dispatchEvent(new Event("change")),r.dispatchEvent(new Event("change"))}getSettingsValues(){return{pomodoroTargetTime:r(this.#c.value),shortBreakTargetTime:r(this.#g.value),longBreakTargetTime:r(this.#T.value),font:e(".js-font-type:checked").value,theme:e(".js-theme-type:checked").value}}showSettingsModal(){this.#d.showModal()}closeSettingsModal(){this.#d.close()}setFont(e){document.documentElement.style.setProperty("--body-font-family",`var(--${e})`)}setTheme(e){document.documentElement.style.setProperty("--accent-color-1",`var(--${e})`)}setNumInputValue(e,t){e.value=t,e.dispatchEvent(new Event("change"))}bindProcessFontSelection(e){this.#p.forEach((t=>{i(t,"change",(function(){this.checked&&e(this.value)}))}))}bindProcessThemeSelection(e){this.#v.forEach((t=>{i(t,"change",(function(){this.checked&&e(this.value)}))}))}bindOpenSettings(e){i(this.#h,"click",e)}bindCloseSettings(e){i(this.#l,"click",e)}bindApplySettings(e){const s=t(".js-settings input");i(this.#u,"click",(function(){e(s)}))}}class u{#y;#S;#f;#w;#I;#M;constructor(){this.#y=e(".js-play-pause-timer"),this.#S=e(".js-restart-timer"),this.#f=e(".js-timer"),this.#w=e(".js-progress-bar circle"),this.#I=t(".js-timer-mode"),this.#M=new Audio("./assets/audio/alarm.mp3"),this.#M.loop=!0,this.#b()}#b(){try{o([{name:"playPauseTimer",el:this.#y},{name:"restartTimer",el:this.#S},{name:"timer",el:this.#f},{name:"progressBar",el:this.#w},{name:"timerModes",el:this.#I}])}catch(e){s(e)}}setTimerAndProgressBarValue(e,t){const i=753.98*(1-e/t);var s;this.#f.innerHTML=(s=e,`${String(Math.floor(s/60)).padStart(2,"0")}:${String(Math.floor(s%60)).padStart(2,"0")}`),this.#w.style.strokeDashoffset=i}setPlayPauseButtonLabel(e){this.#y.innerHTML=e}setPlayPauseButtonDisable(e){this.#y.disabled=e}checkTimerModeButton(t){let i=e(`.js-timer-mode[value="${t}"]`);i.checked=!0,i.dispatchEvent(new Event("change"))}activateTimerFinishedEffect(){this.#M.currentTime=0,this.#M.play(),this.#f.classList.add("timer-finished")}deactivateTimerFinishedEffect(){this.#M.pause(),this.#f.classList.remove("timer-finished")}bindPlayPauseTimer(e){i(this.#y,"click",e)}bindRestartTimer(e){i(this.#S,"click",e)}bindSelectedTimerMode(e){this.#I.forEach((t=>{i(t,"change",(function(){this.checked&&e(this.value)}))}))}}new class{#k;#B;#P;constructor(){this.#k=t(".js-number-input"),this.#B=t(".js-num-input-incrementor"),this.#P=t(".js-num-input-decrementor"),this.#b(),this.bindValidateNumInput(this.validateNumInput.bind(this)),this.bindIncrementNumInput(this.incrementNumInput.bind(this)),this.bindDecrementNumInput(this.decrementNumInput.bind(this))}#b(){try{o([{name:"numInputs",el:this.#k},{name:"inputIncrementors",el:this.#B},{name:"inputDecrementors",el:this.#P}])}catch(e){s(e)}}#R(e){const t=/^\d*$/.test(e),i=Number(e)>=1&&Number(e)<=99;return t&&i||""===e}#V(e,t){e.forEach(((e,s)=>{const r=this.#k[s];i(e,"click",(function(){t(r)}))}))}incrementNumInput(e){let t=Number(e.value);t++,e.value=t,this.validateNumInput(e,"change")}decrementNumInput(e){let t=Number(e.value);t--,e.value=t,this.validateNumInput(e,"change")}validateNumInput(e,t){this.#R(e.value)?(["keydown","mousedown","focusout"].includes(t.type)&&e.setCustomValidity(""),e.oldValue=e.value,e.oldSelectionStart=e.selectionStart,e.oldSelectionEnd=e.selectionEnd):e.hasOwnProperty("oldValue")?(e.setCustomValidity("Please enter a number between 1 and 99 inclusive"),e.reportValidity(),e.value=e.oldValue,e.setSelectionRange(e.oldSelectionStart,e.oldSelectionEnd)):e.value=""}bindIncrementNumInput(e){const t=this.#B;this.#V(t,e)}bindDecrementNumInput(e){const t=this.#P;this.#V(t,e)}bindValidateNumInput(e){["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop","focusout","change"].forEach((t=>{this.#k.forEach((s=>{i(s,t,(function(){e(s,t)}))}))}))}},new class{#E;#C;constructor(){this.#E=e(".js-open-attribution"),this.#C=e(".js-attribution"),this.#b(),this.bindOpenAttribution(this.openAttribution.bind(this))}#b(){try{o([{name:"openAttribution",el:this.#E},{name:"attribution",el:this.#C}])}catch(e){s(e)}}hideAttribution(){this.#C.style.bottom="-5rem",this.#E.disabled=!1,setTimeout((()=>{this.#C.style.visibility="hidden"}),800)}openAttribution(){this.#C.style.visibility="visible",this.#C.style.bottom=0,this.#E.disabled=!0,setTimeout((()=>this.hideAttribution()),3e3)}bindOpenAttribution(e){i(this.#E,"click",e)}};const d=new class{#I;#N;#A;#j;#D;constructor(){const e=this.#F();e?(this.#I=[new h("pomodoro",e.timerModes[0].targetTime,e.timerModes[0].timeRemaining),new h("shortBreak",e.timerModes[1].targetTime,e.timerModes[1].timeRemaining),new h("longBreak",e.timerModes[2].targetTime,e.timerModes[2].timeRemaining)],this.#A=e.currentTimerModeIndex,this.#j=e.font,this.#D=e.theme):(this.#I=[new h("pomodoro",1500),new h("shortBreak",300),new h("longBreak",900)],this.#A=0,this.#j="kumbh-sans",this.#D="robins-egg")}#L(){return this.#I[this.#A]}saveDataToLocalStorage(){const e={timerModes:this.#I.map((e=>({targetTime:e.getTargetTime(),timeRemaining:e.getTimeRemaining()}))),currentTimerModeIndex:this.#A,font:this.#j,theme:this.#D};localStorage.setItem("timerData",JSON.stringify(e))}#F(){return JSON.parse(localStorage.getItem("timerData"))}isTimerRunning(){return void 0!==this.#N}retrieveCurrentTimerModeName(){return this.#L().getName()}retrieveTargetTime(){return this.#L().getTargetTime()}retrieveTimeRemaining(){return this.#L().getTimeRemaining()}decreaseTimeRemainingBy(e){return this.#L().decreaseTimeRemainingBy(e)}restartTimeRemaining(){return this.#L().restartTimeRemaining()}saveCurrentTimerMode(e){const t=this.#I.findIndex((t=>t.getName()===e));this.#A=t}saveTimerIntervalId(e){this.#N=e}clearTimerInterval(){clearInterval(this.#N),this.#N=void 0}saveSettingsValues(e){this.#I[0].setTargetTime(e.pomodoroTargetTime),this.#I[1].setTargetTime(e.shortBreakTargetTime),this.#I[2].setTargetTime(e.longBreakTargetTime),this.#j=e.font,this.#D=e.theme}retrieveSettingsValues(){return{pomodoroTargetTime:this.#I[0].getTargetTime(),shortBreakTargetTime:this.#I[1].getTargetTime(),longBreakTargetTime:this.#I[2].getTargetTime(),font:this.#j,theme:this.#D}}},c=new class{#f;#d;constructor(){this.#f=new u,this.#d=new l}timer(){return this.#f}settings(){return this.#d}},g=new class{#e;#t;#x;#i;constructor(e,t){this.#e=e,this.#t=t,this.#i=new m(e,t.timer()),this.#x=new a(e,t.settings(),this.#i)}setView(){const e=this.#e.retrieveCurrentTimerModeName(),t=this.#e.retrieveSettingsValues();this.#t.timer().checkTimerModeButton(e),this.#t.settings().setSettingsValues(t)}triggerLocalStorageSave(){this.#e.saveDataToLocalStorage()}}(d,c),T=g.setView.bind(g),p=g.triggerLocalStorageSave.bind(g);i(window,"load",T),i(window,"beforeunload",p)})();